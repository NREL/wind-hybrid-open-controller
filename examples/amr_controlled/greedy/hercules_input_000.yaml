# Input YAML for emy_python

# Name
name: example_000

###
# Describe this emulator setup
description: AMR Wind Only

dt: 0.5

hercules_comms:

  amr_wind:

    wind_farm_0:
      type: amr_wind #options are amr_wind or amr_wind_local
      amr_wind_input_file: /projects/ssc/ahenry/whoc/amr_controlled/greedy/wf_0/amr_precursor_0.inp

  helics:

    config:
        name: hercules # What is the purpose of this name
        use_dash_frontend: False
        KAFKA: False
        KAFKA_topics: EMUV1py
        helics: 
            # deltat: 1 # This will be assigned in software
            subscription_topics: [status]
            publication_topics: [control]
            endpoints: []
            helicsport: 23405
        publication_interval: 1
        endpoint_interval: 1
        starttime: 7200
        stoptime: 10800
        Agent: ControlCenter

py_sims:

controller:
  controller_type: SimpleYawController # This may not be needed
  num_turbines: 9 # Should match AMR-Wind! Ideally, would come from AMR-wind
  initial_conditions:
      yaw: 270.0 # degrees (same for all turbines) (will this work?)
  yaw_limits: [-30, 30] # degrees
  yaw_rate: 0.3 # degrees/sec
  yaw_increment: 0.05 # degrees
  lpf_start_time: 180.0 # seconds
  lpf_time_const: 35 # sec
  deadband_thr: 8 # degrees
  dt: 60 # sec
  n_horizon: 12
  alpha: 0.8 # WARNING: if you choose this to be small and set the initial values of the control inputs to 0, solver may get stuck at initial solution
  control_input_domain: continuous
  wind_preview_type: stochastic_interval # wind preview type assumed in MPC: persistent (assumes that current freestream measurements will stay constant over horizon), stochastic_interval, stochastic_sample (sample from Gaussian model of preview), perfect (preview known)
  max_std_dev: 2 # for wind_preview_intervals, +/- number of standard deviations from mean to select sample intervals from
  n_wind_preview_samples: 5
  warm_start: lut # may equal 'previous' to warm-start with time-shifted previous solution,  "lut" to warm-start with lookup table solution, or "random" #TODO
  use_lut_filtered_wind_dir: True
  lut_path: "/home/ahenry/toolboxes/whoc/wind-hybrid-open-controller/examples/mpc_wake_steering_florisstandin/lookup_tables/lut_9.csv"
  generate_lut: False
  nu: 0.001 # step size to add/subtract from yaw angles for stochastic gradient estimate
  use_filtered_wind_dir: False
  floris_input_file: /home/ahenry/toolboxes/whoc/wind-hybrid-open-controller/examples/mpc_wake_steering_florisstandin/floris_gch_9.yaml
  solver: slsqp # may equal serial_refine, slsqp, sequential_slsqp, or zsgd
  basin_hop: False
  offline_probability: 0.0
  state_con_type: extreme # extreme or check_all_samples
  beta: 0.9
  max_iter: 30
  acc: 0.000001
  use_state_cons: True
  use_dyn_state_cons: True





